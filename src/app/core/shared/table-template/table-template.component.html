<div class="w-full max-w-full flex-0">
  <div
    class="relative flex flex-col min-w-0 break-words bg-white border-0 shadow-lg rounded-2xl bg-clip-border px-3 py-6">

    <!-- filters -->
    <div class="grid grid-cols-3">

      <!-- global filter -->
      <div class="col-span-3 lg:col-span-1">
        <mat-form-field appearance="outline">
          <input matInput (keyup)="applyFilter($event)" placeholder="cerca..." [formControl]="globalFilterCtrl">
          <fa-icon matSuffix [icon]="faGlass" class="mr-3"></fa-icon>
        </mat-form-field>
      </div>

      <!-- column select -->
      <div class="col-span-3 lg:col-span-1"></div>

      <!-- icons -->
      <div class="col-span-3 lg:col-span-1 flex justify-end items-center -mt-5">

        @if (canExportToPdf()) {
          <button class="font-normal ease-soft-in-out text-lg text-slate-500 hover:text-slate-800
          rounded-2xl p-2 text-center transition-all hover:bg-slate-200
          w-10 h-10 flex items-center justify-center mr-1"
                  type="button" (click)="_toggleFilter()"
                  matTooltip="Esporta in PDF">
            <fa-icon [icon]="faPdf"></fa-icon>
          </button>
        }

        @if (canExportToXls()) {
          <button class="font-normal ease-soft-in-out text-lg text-slate-500 hover:text-slate-800
          rounded-2xl p-2 text-center transition-all hover:bg-slate-200
          w-10 h-10 flex items-center justify-center mr-1"
                  matTooltip="Esporta in XLS"
                  type="button" (click)="_toggleFilter()">
            <fa-icon [icon]="faExcel"></fa-icon>
          </button>
        }

        @if (activeFilter) {
          <button class="font-normal ease-soft-in-out text-lg text-red-500 hover:text-red-700
          rounded-2xl p-2 text-center transition-all hover:bg-slate-200
          w-10 h-10 flex items-center justify-center mr-1"
                  matTooltip="Cancella i filtri"
                  type="button" (click)="_clearFilter()">
            <fa-icon [icon]="faFilterClear"></fa-icon>
          </button>
        }

        @if (hasFilters()) {
          <button class="font-normal ease-soft-in-out text-lg text-slate-500 hover:text-slate-800
        rounded-2xl p-2 text-center transition-all hover:bg-slate-200
        w-10 h-10 flex items-center justify-center mr-1"
                  [matTooltip]="isFiltersOpen ? 'Chiudi i filtri' : 'Apri i filtri'"
                  type="button" (click)="_toggleFilter()">
            <fa-icon [icon]="faFilter"></fa-icon>
          </button>
        }

        @if (canInsert()) {
          <button class="font-normal ease-soft-in-out text-lg text-slate-500 hover:text-slate-800
          rounded-2xl p-2 text-center transition-all hover:bg-slate-200
          w-10 h-10 flex items-center justify-center"
                  matTooltip="Nuovo Documento"
                  type="button">
            <fa-icon [icon]="faPlus"></fa-icon>
          </button>
        }

      </div>
    </div>

    <!-- table -->
    @if (dataSource && paginator) {
      <div class="overflow-x-auto">
        <table mat-table [dataSource]="dataSource" matSort class="w-full">

          @for (column of displayedColumns(); track column.key) {
            @if (!column.hide) {
              <ng-container [matColumnDef]="column.key" [stickyEnd]="column.stickyEnd">

                @if (column.isSortable) {
                  <th mat-header-cell *matHeaderCellDef
                      class="text-slate-400 min-w-0 flex-grow" [mat-sort-header]="column.key"
                      [class.max-w-32]="column.stickyEnd" [class.w-32]="column.stickyEnd"
                      [class.text-center]="column.align && column.align === ALIGN_OPTIONS.CENTER">
                    <span class="text-xs font-bold tracking-wide uppercase mt-0.5">{{ column.name }}</span>
                  </th>
                } @else {
                  <th mat-header-cell *matHeaderCellDef class="text-slate-400 min-w-0 flex-grow"
                      [class.max-w-32]="column.stickyEnd" [class.w-32]="column.stickyEnd"
                      [class.text-center]="column.align && column.align === ALIGN_OPTIONS.CENTER">
                    <span class="text-xs font-bold tracking-wide uppercase mt-0.5">{{ column.name }}</span>
                  </th>
                }

                <td mat-cell *matCellDef="let row; let i = index"
                    class="min-w-0 flex-grow"
                    [class.max-w-32]="column.stickyEnd" [class.w-32]="column.stickyEnd"
                    [class.text-center]="column.align && column.align === ALIGN_OPTIONS.CENTER">
                  @switch (column.type) {
                    @case (TYPE_OPTIONS.ID) {
                      {{ i + (paginator.pageIndex * paginator.pageSize) + 1 }}
                    }
                    @default {
                      {{ row[column.key] }}
                    }
                  }
                </td>
              </ng-container>
            }
          }

          <!-- filters -->
          @for (column of displayedColumns(); track column.key) {
            @if (!column.hide) {
              <ng-container [matColumnDef]="'_' + column.key" [stickyEnd]="column.stickyEnd">
                <th mat-header-cell *matHeaderCellDef
                    class="text-slate-400 min-w-0 flex-grow"
                    [class.max-w-32]="column.stickyEnd" [class.w-32]="column.stickyEnd">
                  <div class="text-xs font-bold tracking-wide uppercase mt-1">
                    @if (column.search) {
                      <input (click)="$event.stopPropagation()"
                             (keyup)="singleFilter($event, column.key)"
                             class="rounded-md py-1 px-3 text-sm border
                   text-slate-500 placeholder:text-slate-400
                   bg-slate-100  hover:bg-slate-300
                   border-slate-200 hover:border-slate-300
                   focus:outline-none focus:border-slate-400 shadow-sm focus:shadow
                   transition duration-300 ease"
                             [formControlName]="column.key"
                             placeholder="">
                    }
                  </div>
                </th>
              </ng-container>
            }
          }

          <ng-container matColumnDef="emptyRow">
            <td mat-cell *matCellDef="let element" [attr.colspan]="4" class="text-center">
              No Data Available
            </td>
          </ng-container>

          <!-- table headers -->
          <tr mat-header-row *matHeaderRowDef="_getColumnKeys()"></tr>

          <!-- table filters -->
          <tr mat-header-row *matHeaderRowDef="_getColumnKeys(true);"
              [class.animate__fadeInDown]="isFiltersOpen"
              [class.animate__fadeOutUp]="!isFiltersOpen"
              [class.hidden]="!isFiltersOpen">
          </tr>

          <!-- table rows -->
          <tr mat-row *matRowDef="let row; columns: _getColumnKeys(); when: hasData"></tr>

          <tr mat-row *matRowDef="let row; columns: ['emptyRow']; when: noData"></tr>


        </table>

        <!-- paginator -->
        <mat-paginator [pageSize]="pageSize()" [pageSizeOptions]="pageSizeOptions()" aria-label="Select page"
                       showFirstLastButtons></mat-paginator>
      </div>
    }

  </div>
</div>
